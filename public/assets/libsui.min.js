var X=Object.defineProperty,Z=Object.defineProperties;var tt=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var et=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var F=(s,t,e)=>t in s?X(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,H=(s,t)=>{for(var e in t||(t={}))et.call(t,e)&&F(s,e,t[e]);if(K)for(var e of K(t))nt.call(t,e)&&F(s,e,t[e]);return s},J=(s,t)=>Z(s,tt(t));var g=(s,t,e)=>F(s,typeof t!="symbol"?t+"":t,e);var w=(s,t,e)=>new Promise((n,r)=>{var i=l=>{try{c(e.next(l))}catch(a){r(a)}},o=l=>{try{c(e.throw(l))}catch(a){r(a)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,o);c((e=e.apply(s,t)).next())});function $$(s){let t=null;if(typeof s=="string"&&(t=document.querySelector(s)),s instanceof HTMLElement&&(t=s),t){const e=t.getAttribute("s:cn");if(e&&e!=""&&typeof window[e]=="function"){const n=new window[e](t);return new __sui_component(t,n)}}return null}function __sui_component_root(s,t){return s.closest(`[s\\:cn=${t}]`)}function __sui_state(s){this.handlers=s.watch||{},this.Set=function(t,e,n){return w(this,null,function*(){var i;const r=this.handlers[t];if(n=n||s.root,r&&typeof r=="function"){if(yield r(e,{target:n,stopPropagation:function(){n.setAttribute("state-propagation","true")}}),n?n.getAttribute("state-propagation")==="true":!1)return;let l=(i=s.root.parentElement)==null?void 0:i.closest("[s\\:cn]");if(l==null)return;const a=new CustomEvent("state:change",{detail:{key:t,value:e,target:s.root}});l.dispatchEvent(a)}})}}function __sui_props(s){this.Get=function(t){if(!s||typeof s.getAttribute!="function")return null;const e="prop:"+t,n=s.getAttribute(e);if(s.getAttribute("json-attr-prop:"+t)==="true")try{return JSON.parse(n)}catch(i){return null}return n},this.List=function(){const t={};if(!s||typeof s.getAttribute!="function")return t;const e=s.attributes;for(let n=0;n<e.length;n++){const r=e[n];if(r.name.startsWith("prop:")){const i=r.name.replace("prop:","");if(s.getAttribute("json-attr-prop:"+i)==="true"){try{t[i]=JSON.parse(r.value)}catch(c){t[i]=null}continue}t[i]=r.value}}return t}}function __sui_component(s,t){this.root=s,this.store=new __sui_store(s),this.props=new __sui_props(s),this.state=t?new __sui_state(t):{};const e=this;this.$root=new __Query(this.root),this.find=function(n){return new __Query(e.root).find(n)},this.query=function(n){return e.root.querySelector(n)},this.queryAll=function(n){return e.root.querySelectorAll(n)},this.emit=function(n,r){const i=new CustomEvent(n,{detail:r});e.root.dispatchEvent(i)},this.render=function(n,r,i){return new __Render(e,i).Exec(n,r)}}function __sui_event_handler(s,t,e,n,r,i){const o={};n=n||null,n&&(t.forEach(function(c){const l=n.getAttribute("data:"+c);o[c]=l}),e.forEach(function(c){const l=n.getAttribute("json:"+c);if(o[c]=null,l&&l!="")try{o[c]=JSON.parse(l)}catch(a){const d=a.message||a||"An error occurred";console.error(`[SUI] Event Handler Error: ${d} `,n)}})),i&&i(s,o,{rootElement:r,targetElement:n})}function __sui_event_init(s){const t=r=>{let i=r.getAttribute("s:event-cn")||"";if(i==""){const a=r.closest("[s\\:cn]");a&&(i=a.getAttribute("s:cn")||"")}if(i==""){console.error("[SUI] Component name is required for event binding",s);return}const o={},c=[],l=[];for(let a=0;a<r.attributes.length;a++)if(r.attributes[a].name.startsWith("data:")&&c.push(r.attributes[a].name.replace("data:","")),r.attributes[a].name.startsWith("json:")&&l.push(r.attributes[a].name.replace("json:","")),r.attributes[a].name.startsWith("s:on-")){const d=r.attributes[a].name.replace("s:on-","");o[d]=r.attributes[a].value}for(const a in o){const d=o[a];if(i=="__page"){const k=window[d],P=document.body,L=r;r.addEventListener(a,u=>{__sui_event_handler(u,c,l,L,P,k)});continue}const _=r.closest(`[s\\:cn=${i}]`);if(typeof window[i]!="function"){console.error(`[SUI] Component ${i} not found`,r);return}const C=new window[i](_),j=C[d],T=C.root,y=r;r.addEventListener(a,k=>{__sui_event_handler(k,c,l,y,T,j)})}},e=s.querySelectorAll("[s\\:event]"),n=s.querySelectorAll("[s\\:event-jit]");e.forEach(r=>t(r)),n.forEach(r=>t(r))}function __sui_store(s){s=s||document.body,this.Get=function(t){return s.getAttribute("data:"+t)},this.Set=function(t,e){s.setAttribute("data:"+t,e)},this.GetJSON=function(t){const e=s.getAttribute("json:"+t);if(e&&e!="")try{return JSON.parse(e)}catch(n){const r=n.message||n||"An error occurred";return console.error(`[SUI] Event Handler Error: ${r}`,s),null}return null},this.SetJSON=function(t,e){s.setAttribute("json:"+t,JSON.stringify(e))},this.GetData=function(){return this.GetJSON("__component_data")||{}}}function __sui_backend_call(s,t,e,...n){return w(this,null,function*(){const r=`/api/__yao/sui/v1/run${s}`;t=H({"Content-Type":"application/json",Referer:window.location.href,Cookie:document.cookie},t);const i={method:e,args:n};try{const o=JSON.stringify(i),c=yield fetch(r,{method:"POST",headers:t,body:o}),l=yield c.text();let a=null;if(l&&l!=""&&(a=JSON.parse(l)),c.status>=400){const d=a.message?a.message:`Failed to call ${s} ${e}`,_=a.code?a.code:500;return Promise.reject({message:d,code:_})}return Promise.resolve(a)}catch(o){const c=o.message?o.message:`Failed to call ${s} ${e}`,l=o.code?o.code:500;return console.error(`[SUI] Failed to call ${s} ${e}:`,o),Promise.reject({message:c,code:l})}})}function __sui_render(s,t,e,n){return w(this,null,function*(){const r=typeof s=="object"?s:$$(s);if(r==null)return console.error(`[SUI] Component not found: ${s}`),Promise.reject("Component not found");const i=r.root.querySelectorAll(`[s\\:render=${t}]`);if(!i.length)return console.error(`[SUI] No element found with s:render=${t}`),Promise.reject("No element found");n=n||{},n.replace=n.replace===void 0?!0:n.replace,n.showLoader=n.showLoader===void 0?!1:n.showLoader,n.withPageData=n.withPageData===void 0?!1:n.withPageData;let o='<span class="sui-render-loading">Loading...</span>';n.showLoader&&n.replace&&(typeof n.showLoader=="string"?o=n.showLoader:n.showLoader instanceof HTMLElement&&(o=n.showLoader.outerHTML),i.forEach(y=>y.innerHTML=o));let c=r.store.GetData()||{};n.withPageData&&(c=H(H({},c),__sui_data));const l=r.root.closest("[s\\:route]"),a=l?l.getAttribute("s:route"):!1,d=document.body.getAttribute("s:public")||"",_=a?`${d}${a}`:n.route||window.location.pathname;n.component=a&&r.root.getAttribute("s:cn")||"";const C=`/api/__yao/sui/v1/render${_}`,j={name:t,data:c,option:n};if(e)for(const y in e)j.data[y]=e[y];const T={"Content-Type":"application/json",Cookie:document.cookie};try{const y=JSON.stringify(j),P=yield(yield fetch(C,{method:"POST",headers:T,body:y})).text();return n.replace&&i.forEach(L=>{L.innerHTML=P,L.querySelectorAll("[s\\:cn]").forEach(f=>{const S=f.getAttribute("s:ready"),p=f.getAttribute("s:cn");if(S&&p&&typeof window[p]=="function")try{new window[p](f)}catch(v){const $=v.message||v||"An error occurred";console.error(`[SUI] ${p} Error: ${$}`)}});try{__sui_event_init(L)}catch(f){const S=f.message||"Failed to init events";Promise.reject(S)}}),Promise.resolve(P)}catch(y){return i.forEach(k=>{k.innerHTML='<span class="sui-render-error">Failed to render</span>',console.error("Failed to render",y)}),Promise.reject("Failed to render")}})}function $Store(s){if(!s)return null;if(typeof s=="string"){if(s=document.querySelectorAll(s),s.length==0)return null;s=s[0]}return new __sui_store(s)}function $Query(s){return new __Query(s)}class __Query{constructor(t){g(this,"selector","");g(this,"elements",null);g(this,"element",null);typeof t=="string"?(this.selector=t,this.elements=document.querySelectorAll(t),this.elements.length>0&&(this.element=this.elements[0])):t instanceof NodeList?(this.elements=t,this.elements.length>0&&(this.element=this.elements[0])):this.element=t,this.selector=t}elm(){return this.element}elms(){return this.elements}find(t){var n;const e=(n=this.element)==null?void 0:n.querySelector(t);return e?new __Query(e):null}findAll(t){var n;const e=(n=this.element)==null?void 0:n.querySelectorAll(t);return e?new __Query(e):null}closest(t){var n;const e=(n=this.element)==null?void 0:n.closest(t);return e?new __Query(e):null}on(t,e){return this.element?(this.element.addEventListener(t,e),this):this}$$(){if(!this.element)return null;const t=this.element.closest("[s\\:cn]");return t?$$(t):null}each(t){this.elements&&this.elements.forEach((e,n)=>{t(new __Query(e),n)})}store(){return!this.element||typeof this.element.getAttribute!="function"?null:new __sui_store(this.element)}attr(t){return!this.element||typeof this.element.getAttribute!="function"?null:this.element.getAttribute(t)}data(t){return!this.element||typeof this.element.getAttribute!="function"?null:this.element.getAttribute("data:"+t)}json(t){if(!this.element||typeof this.element.getAttribute!="function")return null;const e=this.element.getAttribute("json:"+t);if(!e)return null;try{return JSON.parse(e)}catch(n){return console.error(`Error parsing JSON for key ${t}: ${n}`),null}}prop(t){if(!this.element||typeof this.element.getAttribute!="function")return null;const e="prop:"+t,n=this.element.getAttribute(e);if(this.element.getAttribute("json-attr-prop:"+t)==="true"&&n)try{return JSON.parse(n)}catch(i){return console.error(`Error parsing JSON for prop ${t}: ${i}`),null}return n}hasClass(t){var e;return(e=this.element)==null?void 0:e.classList.contains(t)}toggleClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(n=>{var i;const r=n.replace(/[\n\r\s]/g,"");r!==""&&((i=this.element)==null||i.classList.toggle(r))}),this}removeClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(n=>{var i;const r=n.replace(/[\n\r\s]/g,"");r!==""&&((i=this.element)==null||i.classList.remove(r))}),this}addClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(n=>{var i;const r=n.replace(/[\n\r\s]/g,"");r!==""&&((i=this.element)==null||i.classList.add(r))}),this}html(t){var e;return t===void 0?((e=this.element)==null?void 0:e.innerHTML)||"":(this.element&&(this.element.innerHTML=t),this)}}function $Render(s,t){return new __Render(s,t)}class __Render{constructor(t,e){g(this,"comp",null);g(this,"option",null);this.comp=t,this.option=e}Exec(t,e){return w(this,null,function*(){return __sui_render(this.comp,t,e,this.option)})}}function $Backend(s,t){const e=document.body.getAttribute("s:public")||"/";s=s||window.location.pathname;const n=new RegExp("^"+e);return s=e+s.replace(n,""),new __Backend(s,t)}class __Backend{constructor(t,e={}){g(this,"route","");g(this,"headers",{});this.route=t,this.headers=e}Call(t,...e){return w(this,null,function*(){return yield __sui_backend_call(this.route,this.headers,t,...e)})}}function Yao(s){this.host=`${s||window.location.protocol+"//"+window.location.host}/api`,this.query={},new URLSearchParams(window.location.search).forEach((t,e)=>{this.query[t]=e})}Yao.prototype.Get=function(s,t,e){return w(this,null,function*(){return this.Fetch("GET",s,t,null,e)})},Yao.prototype.Post=function(s,t,e,n){return w(this,null,function*(){return this.Fetch("POST",s,e,t,n)})},Yao.prototype.Download=function(s,t,e,n){return w(this,null,function*(){try{const i=yield this.Fetch("GET",s,t,null,n,!0);var r=window.URL.createObjectURL(i);let o=document.createElement("a");document.body.appendChild(o),o.href=r,o.download=e,o.click(),window.URL.revokeObjectURL(r)}catch(i){alert("\u6210\u529F\u521B\u5EFA\u5BFC\u51FA\u4EFB\u52A1!")}})},Yao.prototype.Fetch=function(s,t,e,n,r,i){return w(this,null,function*(){e=e||{},r=r||{},n=n||null;var o=`${this.host}${t}`,c=this.Serialize(e);c!=""&&(o=o.includes("?")?`${o}&${c}`:`${o}?${c}`);const l=this.Token();l!=""&&(r.authorization=`Bearer ${l}`),r["Content-Type"]||(r["Content-Type"]="application/json");var a={method:s,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:r,redirect:"follow"};n!=null&&(a.body=JSON.stringify(n));const d=yield fetch(o,a),_=d.headers.get("Content-Type")||"";if(_.includes("application/json"))try{return yield d.json()}catch(C){return{code:d.status,message:"empty return"}}else{if(i)return d.blob();if(_.includes("text/html")||_.includes("text/plain"))return d.text()}return d.text()})},Yao.prototype.Token=function(){var s=sessionStorage.getItem("token")||"";return s==""?this.Cookie("__tk")||"":s},Yao.prototype.Cookie=function(s){for(var t=s+"=",e=decodeURIComponent(document.cookie),n=e.split(";"),r=0;r<n.length;r++){var i=n[r].trim();if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null},Yao.prototype.SetCookie=function(s,t,e){e=e||30;var n=new Date;n.setTime(n.getTime()+e*24*60*60*1e3);var r="expires="+n.toUTCString();document.cookie=`${s}=${t};${r};path=/`},Yao.prototype.DeleteCookie=function(s){document.cookie=`${s}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`},Yao.prototype.Serialize=function(s){const t=[];for(const e in s)s.hasOwnProperty(e)&&t.push(encodeURIComponent(e)+"="+encodeURIComponent(s[e]));return t.join("&")};class Agent{constructor(t,e){g(this,"host");g(this,"token");g(this,"events");g(this,"assistant_id");g(this,"chat_id");g(this,"es");g(this,"context");g(this,"silent",!1);g(this,"history_visible",!1);this.host=e.host||"/api/__yao/neo",this.token=e.token,this.events={},this.assistant_id=t,this.chat_id=e.chat_id,this.es=null,this.context=e.context||{},e.silent!==void 0&&(this.silent=!(e.silent===!0||e.silent==="true"||e.silent===1||e.silent==="1")),e.history_visible!==void 0&&(this.history_visible=e.history_visible===!0||e.history_visible==="true"||e.history_visible===1||e.history_visible==="1")}makeChatID(){const t=Math.random().toString(36).substring(2,15);return`chat_${Date.now()}_${t}`}On(t,e){return t==="message"?this.events.message=e:t==="done"&&(this.events.done=e),this}Cancel(){this.es&&(this.es.close(),this.es=null)}Call(t,...e){return w(this,null,function*(){return new Promise((n,r)=>{const i=[];let o={assistant_id:null,assistant_name:null,assistant_avatar:null},c;typeof t=="string"?c={text:t}:(c={text:t.text},t.attachments&&t.attachments.length>0&&(c.attachments=t.attachments.map(u=>({name:u.name,url:u.url,type:u.type,content_type:u.content_type,bytes:u.bytes,created_at:u.created_at,file_id:u.file_id,chat_id:u.chat_id,assistant_id:u.assistant_id,description:u.description}))));const l=J(H({},this.context),{args:e}),a=encodeURIComponent(JSON.stringify(c)),d=encodeURIComponent(JSON.stringify(l)),_=this.token,C=this.silent?"true":"false",j=this.history_visible?"true":"false",T=this.chat_id||this.makeChatID(),y=`&assistant_id=${this.assistant_id}`,k=`${this.host}/status?content=${a}&context=${d}&token=${_}&chat_id=${T}${y}`,P=`${this.host}?client_type=jssdk&content=${a}&context=${d}&token=${_}&silent=${C}&history_visible=${j}&chat_id=${T}${y}`,L=u=>w(this,null,function*(){var f,S,p,v;try{const $=yield fetch(k,{credentials:"include",headers:{Accept:"application/json"}});if($.status===200||$.status===201)return;const x=yield $.json().catch(()=>({message:`HTTP ${$.status}`}));let h="Network error, please try again later";x!=null&&x.message?h=x.message:(f=u.message)!=null&&f.includes("401")?h="Session expired: Please login again":(S=u.message)!=null&&S.includes("403")?h="Access denied: Please check your permissions or login again":(p=u.message)!=null&&p.includes("500")?h="Server error: The service is temporarily unavailable":(v=u.message)!=null&&v.includes("404")?h="AI service not found: Please check your configuration":u.name==="TypeError"&&(h="Connection failed: Please check your network connection");const I=this.events.message;return I&&I({text:h,type:"error",is_neo:!0,done:!0}),r(new Error(h))}catch($){const x=this.events.message;return x&&x({text:"Service unavailable, please try again later",type:"error",is_neo:!0,done:!0}),r(new Error("Service unavailable, please try again later"))}});try{let u=null;const f=new EventSource(P,{withCredentials:!0});this.es=f,f.onopen=()=>{},f.onmessage=({data:S})=>{try{const p=JSON.parse(S);if(!p)return;const v=this.events.message;if(!v)return;const{tool_id:$,begin:x,type:h,end:I,text:b,props:O,done:R,assistant_id:U,assistant_name:G,assistant_avatar:Q,new:W,delta:z,result:M}=p;if(h==="action"){const{namespace:A,primary:E,data_item:D,action:q,extra:V}=O||{};if(q&&Array.isArray(q)){const B={text:b||"",type:"action",props:{namespace:A||"chat",primary:E||"id",data_item:D||{},action:q,extra:V},is_neo:!0,done:!!R};if(i.push(B),v(B),R){const N=this.events.done;N==null||N(i),f.close()}return n(M)}}const Y=h!==u&&(!R||R===!0&&(b||O))||i.length===0||U&&i[i.length-1].assistant_id!==U||W&&!z;if(u=h,U&&(o.assistant_id=U),G&&(o.assistant_name=G),Q&&(o.assistant_avatar=Q),Y){i.length>0&&i[i.length-1].is_neo&&(i[i.length-1]=J(H({},i[i.length-1]),{done:!0}));const A={text:b||"",type:h||"text",props:O,is_neo:!0,new:W,tool_id:$,result:M,assistant_id:o.assistant_id||void 0,assistant_name:o.assistant_name||void 0,assistant_avatar:o.assistant_avatar||void 0};if(i.push(A),v(A),R){const E=this.events.done;return E==null||E(i),f.close(),n(M)}return}const m=i[i.length-1];if(i.length>1){const A=i[i.length-2];A.assistant_id&&(m.previous_assistant_id=A.assistant_id)}if(R){b&&(m.text=b),h&&(m.type=h),O&&(m.props=O),M&&(m.result=M);for(let E=i.length-1;E>=0;E--){const D=i[E];if(D.is_neo){if(D.done)break;i[E]=J(H({},D),{done:!0})}}const A=this.events.done;return A==null||A(i),f.close(),n(M)}if(!b&&!O&&!h)return;O&&(h==="think"||h==="tool"?m.props=J(H({},m.props||{}),{id:$,begin:x,end:I}):m.props=O),b&&(z?(m.text=(m.text||"")+b,b.startsWith("\r")&&(m.text=b.replace("\r",""))):m.text=b),v(m)}catch(p){const v=p.message||JSON.stringify(p)||"\u672A\u77E5\u9519\u8BEF";console.error("Failed to parse message:",p),r(new Error(v))}},f.onerror=S=>{L(S),f.close()}}catch(u){L(u)}})})}}

//# sourceMappingURL=libsui.min.js.map